<h1>Using es2015 javascript packages with Angular CLI</h1>
<p>
  If you followed our <a [routerLink]="['/guides','gettingstarted']">Getting Started Guide</a>,
  it left you with a web application that had two rather inconvenient issues:</p>
<ul>
  <li>If you open the application in a browser that doesn't support a reasonable subset of the latest
    javascript (es2015) features (such as IE11), the application will bail, because of javascript parsing errors.
  </li>
  <li>A production build of the application (using <code>ng build --prod</code>) will also fail with javascript build errors.</li>
</ul>
<p>Both issues have the same cause: Blox Material depends on Google's Material Components for the Web, which is
  distributed in different <code>@material/*</code> npm packages.
  These packages all use es2015 (also called es6, or ecmascript 2015) features that not all browsers support.
  Angular CLI also doesn't support minifying es2015, which explains why a production build fails.</p>
<p>This guide shows one way to solve this issue, while still being able to use Angular CLI to manage
  your project.
</p>

<h2>Step 1: Upgrade Angular CLI</h2>
<p>
Luckily, the upcoming 1.5.0 Angular CLI will have more support for es2015, and we can already install
release candidates for that version. In the root directory of your project, type the following command to
upgrade to angular cli 1.5.0-rc.2 (for this project only, so do <strong>not</strong> add the <code>-g</code> flag):</p>
<div class="blox-code-sample">
  <pre><code mwlHighlightJs [source]="'npm install --save-dev @angular/cli@1.5.0-rc.2'" [language]="'bash'"></code></pre>
</div>
<p>Next change <code>"target": "es5"</code> in the file <code>tsconfig.json</code> into: <code>"target": "es2015"</code>.
This will instruct Angular CLI to compile typescript to es2015 javascript, and it will now also support minifying
es2015 javascript (which is what we need for production builds).</p>
<p>Now, running: <code>ng build --prod --build-optimizer</code> will not bail with errors anymore, but will create
a production optimized distribution of your application in the <code>dist</code> directory.
</p>
<blockquote>
We added the argument <code>--build-optimizer</code>, which makes more agressive tree shaking possible,
and therefore creates smaller production builds. This option is officially still experimental, if it poses problems,
you can always leave it out.
</blockquote>
<p>
Just one more thing: <code>ng serve</code> does not work with <code>es2015</code> targets. You can use
<code>ng serve --aot</code> which does work for testing and debugging your application.
</p>

<h2>Step 2: Generate ES5 compatible Javascript</h2>
<p>
  So now you have your production build. But the javascript code still uses <code>es2015</code> features not supported
  in Internet Explorer. To solve this, we are going to install a nifty utility to postprocess the javascript and html
  generated by the build, and transpile the javascript to es5 code:
</p>
<div class="blox-code-sample">
  <pre><code mwlHighlightJs [source]="'npm install --save-dev @blox/ng-utils'" [language]="'bash'"></code></pre>
</div>
<p>
  Now open your <code>package.json</code> and edit your scripts section to customize the <code>start</code>
  and <code>build</code> scripts, and add a <code>transpile</code> script:
</p>
<div class="blox-code-sample">
  <pre><code mwlHighlightJs [source]="pkgTasks" [language]="'json'"></code></pre>
</div>

<h2>Step 3: Add the required polyfills</h2>
<p>
  Angular CLI has created a <code>src/polyfills.ts</code> file for supporting older browsers, but by default it
  has commented out all polyfills required for Internet Explorer. So to support Internet Explorer, remove the comments
  at the start of the file. This will make it look like:
</p>
<div class="blox-code-sample">
  <pre><code mwlHighlightJs [source]="tsPolyfills" [language]="'json'"></code></pre>
</div>
<p>
  Also, as instructed for the <code>classlist.js</code> polyfill, run:
</p>
<div class="blox-code-sample">
  <pre><code mwlHighlightJs [source]="'npm install --save classlist.js'" [language]="'bash'"></code></pre>
</div>
<p>From now on use the following command to start/debug your application (instead of <code>ng serve</code>):</p>
<div class="blox-code-sample">
  <pre><code mwlHighlightJs [source]="'npm run start'" [language]="'bash'"></code></pre>
</div>
<p>And use the following command to create a production distribution of your application (instead of <code>ng build --prod</code>):</p>
<div class="blox-code-sample">
  <pre><code mwlHighlightJs [source]="'npm run build'" [language]="'bash'"></code></pre>
</div>
<p>
  Congratulations! You now have your Angular application fully integrated with Blox Material, optimized and working for
  any browser supported by Angular.
  Now head to the <a [routerLink]="['/directives']">directives documentation</a> for code samples and instructions on
  how to use all Material components in your app!
</p>
